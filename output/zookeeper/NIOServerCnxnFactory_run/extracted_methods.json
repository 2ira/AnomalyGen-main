{
    "org.apache.zookeeper.server.NIOServerCnxn:doIO(java.nio.channels.SelectionKey)": {
        "source_code": "/**\n * Handles read/write IO on connection.\n */\nvoid doIO(SelectionKey k) throws InterruptedException {\n    try {\n        if (!isSocketOpen()) {\n            LOG.warn(\"trying to do i/o on a null socket for session: 0x{}\", Long.toHexString(sessionId));\n            return;\n        }\n        if (k.isReadable()) {\n            int rc = sock.read(incomingBuffer);\n            if (rc < 0) {\n                try {\n                    handleFailedRead();\n                } catch (EndOfStreamException e) {\n                    // no stacktrace. this case is very common, and it is usually not a problem.\n                    LOG.info(\"{}\", e.getMessage());\n                    // expecting close to log session closure\n                    close(e.getReason());\n                    return;\n                }\n            }\n            if (incomingBuffer.remaining() == 0) {\n                boolean isPayload;\n                if (incomingBuffer == lenBuffer) {\n                    // start of next request\n                    incomingBuffer.flip();\n                    isPayload = readLength(k);\n                    incomingBuffer.clear();\n                } else {\n                    // continuation\n                    isPayload = true;\n                }\n                if (isPayload) {\n                    // not the case for 4letterword\n                    readPayload();\n                } else {\n                    // four letter words take care\n                    // need not do anything else\n                    return;\n                }\n            }\n        }\n        if (k.isWritable()) {\n            handleWrite(k);\n            if (!initialized && !getReadInterest() && !getWriteInterest()) {\n                throw new CloseRequestException(\"responded to info probe\", DisconnectReason.INFO_PROBE);\n            }\n        }\n    } catch (CancelledKeyException e) {\n        LOG.warn(\"CancelledKeyException causing close of session: 0x{}\", Long.toHexString(sessionId));\n        LOG.debug(\"CancelledKeyException stack trace\", e);\n        close(DisconnectReason.CANCELLED_KEY_EXCEPTION);\n    } catch (CloseRequestException e) {\n        // expecting close to log session closure\n        close();\n    } catch (EndOfStreamException e) {\n        LOG.warn(\"Unexpected exception\", e);\n        // expecting close to log session closure\n        close(e.getReason());\n    } catch (ClientCnxnLimitException e) {\n        // Common case exception, print at debug level\n        ServerMetrics.getMetrics().CONNECTION_REJECTED.add(1);\n        LOG.warn(\"Closing session 0x{}\", Long.toHexString(sessionId), e);\n        close(DisconnectReason.CLIENT_CNX_LIMIT);\n    } catch (IOException e) {\n        LOG.warn(\"Close of session 0x{}\", Long.toHexString(sessionId), e);\n        close(DisconnectReason.IO_EXCEPTION);\n    }\n}",
        "file_path": "zookeeper/zookeeper-server/src/main/java/org/apache/zookeeper/server/NIOServerCnxn.java"
    },
    "org.apache.zookeeper.server.NIOServerCnxn:close()": {
        "source_code": "private void close() {\n    setStale();\n    if (!factory.removeCnxn(this)) {\n        return;\n    }\n    if (zkServer != null) {\n        zkServer.removeCnxn(this);\n    }\n    if (sk != null) {\n        try {\n            // need to cancel this selection key from the selector\n            sk.cancel();\n        } catch (Exception e) {\n            LOG.debug(\"ignoring exception during selectionkey cancel\", e);\n        }\n    }\n    closeSock();\n}",
        "file_path": "zookeeper/zookeeper-server/src/main/java/org/apache/zookeeper/server/NIOServerCnxn.java"
    },
    "org.apache.zookeeper.server.NIOServerCnxnFactory:closeAll()": {
        "source_code": "/**\n * clear all the connections in the selector\n */\n@Override\n@SuppressWarnings(\"unchecked\")\npublic void closeAll(ServerCnxn.DisconnectReason reason) {\n    // clear all the connections on which we are selecting\n    for (ServerCnxn cnxn : cnxns) {\n        try {\n            // This will remove the cnxn from cnxns\n            cnxn.close(reason);\n        } catch (Exception e) {\n            LOG.warn(\"Ignoring exception closing cnxn session id 0x{}\", Long.toHexString(cnxn.getSessionId()), e);\n        }\n    }\n}",
        "file_path": "zookeeper/zookeeper-server/src/main/java/org/apache/zookeeper/server/NIOServerCnxnFactory.java"
    }
}