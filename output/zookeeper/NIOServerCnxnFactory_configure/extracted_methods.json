{
    "org.apache.zookeeper.Login:startThreadIfNeeded()": {
        "source_code": "public void startThreadIfNeeded() {\n    // thread object 't' will be null if a refresh thread is not needed.\n    if (t != null) {\n        t.start();\n    }\n}",
        "file_path": "zookeeper/zookeeper-server/src/main/java/org/apache/zookeeper/Login.java"
    },
    "org.apache.zookeeper.server.ServerCnxnFactory:configureSaslLogin()": {
        "source_code": "/**\n * Initialize the server SASL if specified.\n *\n * If the user has specified a \"ZooKeeperServer.LOGIN_CONTEXT_NAME_KEY\"\n * or a jaas.conf using \"java.security.auth.login.config\"\n * the authentication is required and an exception is raised.\n * Otherwise no authentication is configured and no exception is raised.\n *\n * @throws IOException if jaas.conf is missing or there's an error in it.\n */\nprotected void configureSaslLogin() throws IOException {\n    String serverSection = System.getProperty(ZooKeeperSaslServer.LOGIN_CONTEXT_NAME_KEY, ZooKeeperSaslServer.DEFAULT_LOGIN_CONTEXT_NAME);\n    // Note that 'Configuration' here refers to javax.security.auth.login.Configuration.\n    AppConfigurationEntry[] entries = null;\n    SecurityException securityException = null;\n    try {\n        entries = Configuration.getConfiguration().getAppConfigurationEntry(serverSection);\n    } catch (SecurityException e) {\n        // handle below: might be harmless if the user doesn't intend to use JAAS authentication.\n        securityException = e;\n    }\n    // No entries in jaas.conf\n    // If there's a configuration exception fetching the jaas section and\n    // the user has required sasl by specifying a LOGIN_CONTEXT_NAME_KEY or a jaas file\n    // we throw an exception otherwise we continue without authentication.\n    if (entries == null) {\n        String jaasFile = System.getProperty(Environment.JAAS_CONF_KEY);\n        String loginContextName = System.getProperty(ZooKeeperSaslServer.LOGIN_CONTEXT_NAME_KEY);\n        if (securityException != null && (loginContextName != null || jaasFile != null)) {\n            String errorMessage = \"No JAAS configuration section named '\" + serverSection + \"' was found\";\n            if (jaasFile != null) {\n                errorMessage += \" in '\" + jaasFile + \"'.\";\n            }\n            if (loginContextName != null) {\n                errorMessage += \" But \" + ZooKeeperSaslServer.LOGIN_CONTEXT_NAME_KEY + \" was set.\";\n            }\n            LOG.error(errorMessage, securityException);\n            throw new IOException(errorMessage);\n        }\n        return;\n    }\n    // jaas.conf entry available\n    try {\n        Map<String, String> credentials = getDigestMd5Credentials(entries);\n        Supplier<CallbackHandler> callbackHandlerSupplier = () -> {\n            return new SaslServerCallbackHandler(credentials);\n        };\n        login = new Login(serverSection, callbackHandlerSupplier, new ZKConfig());\n        setLoginUser(login.getUserName());\n        login.startThreadIfNeeded();\n    } catch (LoginException e) {\n        throw new IOException(\"Could not configure server because SASL configuration did not allow the \" + \" ZooKeeper server to authenticate itself properly: \" + e);\n    }\n}",
        "file_path": "zookeeper/zookeeper-server/src/main/java/org/apache/zookeeper/server/ServerCnxnFactory.java"
    },
    "org.apache.zookeeper.server.NIOServerCnxnFactory:configure(java.net.InetSocketAddress,int)": {
        "source_code": "@Override\npublic void configure(InetSocketAddress addr, int maxcc, int backlog, boolean secure) throws IOException {\n    if (secure) {\n        throw new UnsupportedOperationException(\"SSL isn't supported in NIOServerCnxn\");\n    }\n    configureSaslLogin();\n    maxClientCnxns = maxcc;\n    initMaxCnxns();\n    sessionlessCnxnTimeout = Integer.getInteger(ZOOKEEPER_NIO_SESSIONLESS_CNXN_TIMEOUT, 10000);\n    // We also use the sessionlessCnxnTimeout as expiring interval for\n    // cnxnExpiryQueue. These don't need to be the same, but the expiring\n    // interval passed into the ExpiryQueue() constructor below should be\n    // less than or equal to the timeout.\n    cnxnExpiryQueue = new ExpiryQueue<>(sessionlessCnxnTimeout);\n    expirerThread = new ConnectionExpirerThread();\n    int numCores = Runtime.getRuntime().availableProcessors();\n    // 32 cores sweet spot seems to be 4 selector threads\n    numSelectorThreads = Integer.getInteger(ZOOKEEPER_NIO_NUM_SELECTOR_THREADS, Math.max((int) Math.sqrt((float) numCores / 2), 1));\n    if (numSelectorThreads < 1) {\n        throw new IOException(\"numSelectorThreads must be at least 1\");\n    }\n    numWorkerThreads = Integer.getInteger(ZOOKEEPER_NIO_NUM_WORKER_THREADS, 2 * numCores);\n    workerShutdownTimeoutMS = Long.getLong(ZOOKEEPER_NIO_SHUTDOWN_TIMEOUT, 5000);\n    String logMsg = \"Configuring NIO connection handler with \" + (sessionlessCnxnTimeout / 1000) + \"s sessionless connection timeout, \" + numSelectorThreads + \" selector thread(s), \" + (numWorkerThreads > 0 ? numWorkerThreads : \"no\") + \" worker threads, and \" + (directBufferBytes == 0 ? \"gathered writes.\" : (\"\" + (directBufferBytes / 1024) + \" kB direct buffers.\"));\n    LOG.info(logMsg);\n    for (int i = 0; i < numSelectorThreads; ++i) {\n        selectorThreads.add(new SelectorThread(i));\n    }\n    listenBacklog = backlog;\n    this.ss = ServerSocketChannel.open();\n    ss.socket().setReuseAddress(true);\n    LOG.info(\"binding to port {}\", addr);\n    if (listenBacklog == -1) {\n        ss.socket().bind(addr);\n    } else {\n        ss.socket().bind(addr, listenBacklog);\n    }\n    if (addr.getPort() == 0) {\n        // We're likely bound to a different port than was requested, so log that too\n        LOG.info(\"bound to port {}\", ss.getLocalAddress());\n    }\n    ss.configureBlocking(false);\n    acceptThread = new AcceptThread(ss, addr, selectorThreads);\n}",
        "file_path": "zookeeper/zookeeper-server/src/main/java/org/apache/zookeeper/server/NIOServerCnxnFactory.java"
    }
}