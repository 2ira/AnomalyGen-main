{
    "org.apache.zookeeper.server.quorum.QuorumPeerConfig:parseProperties(java.util.Properties)": {
        "source_code": "/**\n * Parse config from a Properties.\n * @param zkProp Properties to parse from.\n * @throws IOException\n * @throws ConfigException\n */\npublic void parseProperties(Properties zkProp) throws IOException, ConfigException {\n    Integer clientPort = null;\n    Integer secureClientPort = null;\n    int observerMasterPort = 0;\n    String clientPortAddress = null;\n    String secureClientPortAddress = null;\n    VerifyingFileFactory vff = new VerifyingFileFactory.Builder(LOG).warnForRelativePath().build();\n    for (Entry<Object, Object> entry : zkProp.entrySet()) {\n        String key = entry.getKey().toString().trim();\n        String value = entry.getValue().toString().trim();\n        if (key.equals(\"dataDir\")) {\n            dataDir = vff.create(value);\n        } else if (key.equals(\"dataLogDir\")) {\n            dataLogDir = vff.create(value);\n        } else if (key.equals(\"clientPort\")) {\n            clientPort = Integer.parseInt(value);\n        } else if (key.equals(\"localSessionsEnabled\")) {\n            localSessionsEnabled = parseBoolean(key, value);\n        } else if (key.equals(\"localSessionsUpgradingEnabled\")) {\n            localSessionsUpgradingEnabled = parseBoolean(key, value);\n        } else if (key.equals(\"clientPortAddress\")) {\n            clientPortAddress = value.trim();\n        } else if (key.equals(\"secureClientPort\")) {\n            secureClientPort = Integer.parseInt(value);\n        } else if (key.equals(\"secureClientPortAddress\")) {\n            secureClientPortAddress = value.trim();\n        } else if (key.equals(\"observerMasterPort\")) {\n            observerMasterPort = Integer.parseInt(value);\n        } else if (key.equals(\"clientPortListenBacklog\")) {\n            clientPortListenBacklog = Integer.parseInt(value);\n        } else if (key.equals(\"tickTime\")) {\n            tickTime = Integer.parseInt(value);\n        } else if (key.equals(\"maxClientCnxns\")) {\n            maxClientCnxns = Integer.parseInt(value);\n        } else if (key.equals(\"minSessionTimeout\")) {\n            minSessionTimeout = Integer.parseInt(value);\n        } else if (key.equals(\"maxSessionTimeout\")) {\n            maxSessionTimeout = Integer.parseInt(value);\n        } else if (key.equals(\"initLimit\")) {\n            initLimit = Integer.parseInt(value);\n        } else if (key.equals(\"syncLimit\")) {\n            syncLimit = Integer.parseInt(value);\n        } else if (key.equals(\"connectToLearnerMasterLimit\")) {\n            connectToLearnerMasterLimit = Integer.parseInt(value);\n        } else if (key.equals(\"electionAlg\")) {\n            electionAlg = Integer.parseInt(value);\n            if (electionAlg != 3) {\n                throw new ConfigException(\"Invalid electionAlg value. Only 3 is supported.\");\n            }\n        } else if (key.equals(\"quorumListenOnAllIPs\")) {\n            quorumListenOnAllIPs = parseBoolean(key, value);\n        } else if (key.equals(\"peerType\")) {\n            if (value.toLowerCase().equals(\"observer\")) {\n                peerType = LearnerType.OBSERVER;\n            } else if (value.toLowerCase().equals(\"participant\")) {\n                peerType = LearnerType.PARTICIPANT;\n            } else {\n                throw new ConfigException(\"Unrecognised peertype: \" + value);\n            }\n        } else if (key.equals(\"syncEnabled\")) {\n            syncEnabled = parseBoolean(key, value);\n        } else if (key.equals(\"dynamicConfigFile\")) {\n            dynamicConfigFileStr = value;\n        } else if (key.equals(\"autopurge.snapRetainCount\")) {\n            snapRetainCount = Integer.parseInt(value);\n        } else if (key.equals(\"autopurge.purgeInterval\")) {\n            if (Character.isDigit(value.charAt(value.length() - 1))) {\n                // default is hours for backward compatibility\n                purgeIntervalInMs = Time.parseTimeInterval(value) * Time.HOUR;\n            } else {\n                purgeIntervalInMs = Time.parseTimeInterval(value);\n            }\n        } else if (key.equals(\"standaloneEnabled\")) {\n            setStandaloneEnabled(parseBoolean(key, value));\n        } else if (key.equals(\"reconfigEnabled\")) {\n            setReconfigEnabled(parseBoolean(key, value));\n        } else if (key.equals(\"sslQuorum\")) {\n            sslQuorum = parseBoolean(key, value);\n        } else if (key.equals(\"portUnification\")) {\n            shouldUsePortUnification = parseBoolean(key, value);\n        } else if (key.equals(\"sslQuorumReloadCertFiles\")) {\n            sslQuorumReloadCertFiles = parseBoolean(key, value);\n        } else if ((key.startsWith(\"server.\") || key.startsWith(\"group\") || key.startsWith(\"weight\")) && zkProp.containsKey(\"dynamicConfigFile\")) {\n            throw new ConfigException(\"parameter: \" + key + \" must be in a separate dynamic config file\");\n        } else if (key.equals(QuorumAuth.QUORUM_SASL_AUTH_ENABLED)) {\n            quorumEnableSasl = parseBoolean(key, value);\n        } else if (key.equals(QuorumAuth.QUORUM_SERVER_SASL_AUTH_REQUIRED)) {\n            quorumServerRequireSasl = parseBoolean(key, value);\n        } else if (key.equals(QuorumAuth.QUORUM_LEARNER_SASL_AUTH_REQUIRED)) {\n            quorumLearnerRequireSasl = parseBoolean(key, value);\n        } else if (key.equals(QuorumAuth.QUORUM_LEARNER_SASL_LOGIN_CONTEXT)) {\n            quorumLearnerLoginContext = value;\n        } else if (key.equals(QuorumAuth.QUORUM_SERVER_SASL_LOGIN_CONTEXT)) {\n            quorumServerLoginContext = value;\n        } else if (key.equals(QuorumAuth.QUORUM_KERBEROS_SERVICE_PRINCIPAL)) {\n            quorumServicePrincipal = value;\n        } else if (key.equals(\"quorum.cnxn.threads.size\")) {\n            quorumCnxnThreadsSize = Integer.parseInt(value);\n        } else if (key.equals(JvmPauseMonitor.INFO_THRESHOLD_KEY)) {\n            jvmPauseInfoThresholdMs = Long.parseLong(value);\n        } else if (key.equals(JvmPauseMonitor.WARN_THRESHOLD_KEY)) {\n            jvmPauseWarnThresholdMs = Long.parseLong(value);\n        } else if (key.equals(JvmPauseMonitor.SLEEP_TIME_MS_KEY)) {\n            jvmPauseSleepTimeMs = Long.parseLong(value);\n        } else if (key.equals(JvmPauseMonitor.JVM_PAUSE_MONITOR_FEATURE_SWITCH_KEY)) {\n            jvmPauseMonitorToRun = parseBoolean(key, value);\n        } else if (key.equals(\"metricsProvider.className\")) {\n            metricsProviderClassName = value;\n        } else if (key.startsWith(\"metricsProvider.\")) {\n            String keyForMetricsProvider = key.substring(16);\n            metricsProviderConfiguration.put(keyForMetricsProvider, value);\n        } else if (key.equals(\"multiAddress.enabled\")) {\n            multiAddressEnabled = parseBoolean(key, value);\n        } else if (key.equals(\"multiAddress.reachabilityCheckTimeoutMs\")) {\n            multiAddressReachabilityCheckTimeoutMs = Integer.parseInt(value);\n        } else if (key.equals(\"multiAddress.reachabilityCheckEnabled\")) {\n            multiAddressReachabilityCheckEnabled = parseBoolean(key, value);\n        } else if (key.equals(\"oraclePath\")) {\n            oraclePath = value;\n        } else {\n            System.setProperty(\"zookeeper.\" + key, value);\n        }\n    }\n    if (!quorumEnableSasl && quorumServerRequireSasl) {\n        throw new IllegalArgumentException(QuorumAuth.QUORUM_SASL_AUTH_ENABLED + \" is disabled, so cannot enable \" + QuorumAuth.QUORUM_SERVER_SASL_AUTH_REQUIRED);\n    }\n    if (!quorumEnableSasl && quorumLearnerRequireSasl) {\n        throw new IllegalArgumentException(QuorumAuth.QUORUM_SASL_AUTH_ENABLED + \" is disabled, so cannot enable \" + QuorumAuth.QUORUM_LEARNER_SASL_AUTH_REQUIRED);\n    }\n    // If quorumpeer learner is not auth enabled then self won't be able to\n    // join quorum. So this condition is ensuring that the quorumpeer learner\n    // is also auth enabled while enabling quorum server require sasl.\n    if (!quorumLearnerRequireSasl && quorumServerRequireSasl) {\n        throw new IllegalArgumentException(QuorumAuth.QUORUM_LEARNER_SASL_AUTH_REQUIRED + \" is disabled, so cannot enable \" + QuorumAuth.QUORUM_SERVER_SASL_AUTH_REQUIRED);\n    }\n    // Reset to MIN_SNAP_RETAIN_COUNT if invalid (less than 3)\n    // PurgeTxnLog.purge(File, File, int) will not allow to purge less\n    // than 3.\n    if (snapRetainCount < MIN_SNAP_RETAIN_COUNT) {\n        LOG.warn(\"Invalid autopurge.snapRetainCount: \" + snapRetainCount + \". Defaulting to \" + MIN_SNAP_RETAIN_COUNT);\n        snapRetainCount = MIN_SNAP_RETAIN_COUNT;\n    }\n    if (dataDir == null) {\n        throw new IllegalArgumentException(\"dataDir is not set\");\n    }\n    if (dataLogDir == null) {\n        dataLogDir = dataDir;\n    }\n    if (clientPort == null) {\n        LOG.info(\"clientPort is not set\");\n        if (clientPortAddress != null) {\n            throw new IllegalArgumentException(\"clientPortAddress is set but clientPort is not set\");\n        }\n    } else if (clientPortAddress != null) {\n        this.clientPortAddress = new InetSocketAddress(InetAddress.getByName(clientPortAddress), clientPort);\n        LOG.info(\"clientPortAddress is {}\", formatInetAddr(this.clientPortAddress));\n    } else {\n        this.clientPortAddress = new InetSocketAddress(clientPort);\n        LOG.info(\"clientPortAddress is {}\", formatInetAddr(this.clientPortAddress));\n    }\n    if (secureClientPort == null) {\n        LOG.info(\"secureClientPort is not set\");\n        if (secureClientPortAddress != null) {\n            throw new IllegalArgumentException(\"secureClientPortAddress is set but secureClientPort is not set\");\n        }\n    } else if (secureClientPortAddress != null) {\n        this.secureClientPortAddress = new InetSocketAddress(InetAddress.getByName(secureClientPortAddress), secureClientPort);\n        LOG.info(\"secureClientPortAddress is {}\", formatInetAddr(this.secureClientPortAddress));\n    } else {\n        this.secureClientPortAddress = new InetSocketAddress(secureClientPort);\n        LOG.info(\"secureClientPortAddress is {}\", formatInetAddr(this.secureClientPortAddress));\n    }\n    if (this.secureClientPortAddress != null) {\n        configureSSLAuth();\n    }\n    if (observerMasterPort <= 0) {\n        LOG.info(\"observerMasterPort is not set\");\n    } else {\n        this.observerMasterPort = observerMasterPort;\n        LOG.info(\"observerMasterPort is {}\", observerMasterPort);\n    }\n    if (tickTime == 0) {\n        throw new IllegalArgumentException(\"tickTime is not set\");\n    }\n    minSessionTimeout = minSessionTimeout == -1 ? tickTime * 2 : minSessionTimeout;\n    maxSessionTimeout = maxSessionTimeout == -1 ? tickTime * 20 : maxSessionTimeout;\n    if (minSessionTimeout > maxSessionTimeout) {\n        throw new IllegalArgumentException(\"minSessionTimeout must not be larger than maxSessionTimeout\");\n    }\n    LOG.info(\"metricsProvider.className is {}\", metricsProviderClassName);\n    try {\n        Class.forName(metricsProviderClassName, false, Thread.currentThread().getContextClassLoader());\n    } catch (ClassNotFoundException error) {\n        throw new IllegalArgumentException(\"metrics provider class was not found\", error);\n    }\n    // backward compatibility - dynamic configuration in the same file as\n    // static configuration params see writeDynamicConfig()\n    if (dynamicConfigFileStr == null) {\n        setupQuorumPeerConfig(zkProp, true);\n        if (isDistributed() && isReconfigEnabled()) {\n            // we don't backup static config for standalone mode.\n            // we also don't backup if reconfig feature is disabled.\n            backupOldConfig();\n        }\n    }\n}",
        "file_path": "zookeeper/zookeeper-server/src/main/java/org/apache/zookeeper/server/quorum/QuorumPeerConfig.java"
    },
    "org.apache.zookeeper.server.quorum.flexible.QuorumHierarchical:computeGroupWeight()": {
        "source_code": "/**\n * This method pre-computes the weights of groups to speed up processing\n * when validating a given set. We compute the weights of groups in\n * different places, so we have a separate method.\n */\nprivate void computeGroupWeight() {\n    for (Entry<Long, Long> entry : serverGroup.entrySet()) {\n        Long sid = entry.getKey();\n        Long gid = entry.getValue();\n        if (!groupWeight.containsKey(gid)) {\n            groupWeight.put(gid, serverWeight.get(sid));\n        } else {\n            long totalWeight = serverWeight.get(sid) + groupWeight.get(gid);\n            groupWeight.put(gid, totalWeight);\n        }\n    }\n    /*\n         * Do not consider groups with weight zero\n         */\n    for (long weight : groupWeight.values()) {\n        LOG.debug(\"Group weight: {}\", weight);\n        if (weight == ((long) 0)) {\n            numGroups--;\n            LOG.debug(\"One zero-weight group: 1, {}\", numGroups);\n        }\n    }\n}",
        "file_path": "zookeeper/zookeeper-server/src/main/java/org/apache/zookeeper/server/quorum/flexible/QuorumHierarchical.java"
    }
}